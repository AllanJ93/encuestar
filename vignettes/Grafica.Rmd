---
title: "Clase Grafica"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Clase Grafica}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.asp = .6, fig.width = 12, out.width="100%", dpi = 300
)
```

```{r setup}
library(encuestar)
library(dplyr)
# usethis::load_all()
```

```{r correcciones_data}
datos_demo <- datos_demo |> mutate(across(contains("evaluacion_"), ~as.numeric(.x)))
cuestionario_demo <-  cuestionario_demo|> 
  mutate(tema = if_else(llaves =="evaluacion_amlo", "AMLO", tema),
         tema = if_else(llaves =="evaluacion_rutilio", "Rutilio", tema)
  )
```


```{r clase_grafica}
diseno <- survey::svydesign(ids = ~1, data = datos_demo)

gr <- Grafica$new(diseno = diseno, diccionario = cuestionario_demo, tema = tema_default)

```

# Gauge numérica

```{r}
gr$gauge_numerica(codigo = evaluacion_amlo, color = "red", escala = c(0, 11), size_text_pct = 18)

```

# Gauge categórica

```{r}
gr$gauge_categorica(codigo = persona_lenguaindigena, filtro = "respuesta == 'Sí'", color = "red", escala = c(0, 1), size_text_pct = 18)

```

# Barras categórica

```{r}
gr$barras_categorica(codigo = problema_masimportante, 
                     salto = 20)

```

# Barras numérica

```{r}
gr$barras_numerica(patron_inicial = conocimiento,
                   aspectos = c("era", "sasil"), filtro = "respuesta == 'Sí'",
                   salto = 20, porcentajes_fuera = F)

```

# Barras multirespuesta

```{r}
gr$barras_multirespuesta()

```

# Intervalo numérica

```{r}
gr$intervalo_numerica(patron = "evaluacion", aspectos = c("amlo", "rutilio"), escala = c(0, 10))

```

# Sankey

```{r}
gr$sankey_categorica(variables = c("sexo", "conocimiento_manuelita"))

```

# Nube de texto
```{r}
gr$nube_texto(codigo = "problema_masimportante_otro",
              palabrasVacias = c("muy", "anteriores", "mas", "todas", "falta"),
              total_palabras = 15)

```

# Candidato opinion

```{r}
gr$candidato_opinion(patron_inicial = opinion,
                     aspectos = c("era", "sasil"), ns_nc = "Ns/Nc (No leer)", regular = "Regular (No leer)",
                     grupo_positivo= c("Buena"), grupo_negativo = c("Mala"),
                     orden_resp = c("Mala", "Regular (No leer)", "Buena"))

```

# Candidato partido

```{r}
nombres_candidatos <- cuestionario_demo %>%
  filter(grepl(pattern = "Bloque 5:", x = bloque)) |>
  filter(grepl("partido_",llaves)) %>%
  pull(tema)

color_morena <- "#A6032F"
color_morena_complemento <- "#F5CD5F"
color_panal <- "#03A6A6"
color_pt <- "#D91136"
color_pri <- "#038C33"
color_mc <- "#F27405"
color_pvem <- "#98BF5E"
color_pan <- "#0339a6"
color_prd <- "#F2B705"

color_pencsolchis <- "#AE95BF"
color_chisunido <- "#0396A6"
color_rspchis <-"#D9526B"
color_pmchis <- "#6B3A8C"

color_otro <- "gray30"
color_ninguno <- "black"
color_nsnc <- "gray60"

gr <- Grafica$new(diseno = diseno, diccionario = cuestionario_demo, tema = tema_default)

gr$candidato_partido(llave_partido = "partido", llave_conocimiento = "conocimiento", respuesta_conoce = "Sí",
                     candidatos = c("era", "sasil"), corte_otro = 0.03, cliente = c("era", "sasil"),
                     colores_candidatos = rep("#5B0A1C", 6) %>% purrr::set_names(nombres_candidatos),
                     colores_partido = c("PAN" = color_pan,
                                         "PRI" = color_pri,
                                         "PRD" = color_prd,
                                         "PT" = color_pt,
                                         "Partido Verde (PVEM)" = color_pvem,
                                         "Movimiento Ciudadano (MC)" = color_mc,
                                         "MORENA" = color_morena,
                                         "Chiapas Unido" = color_chisunido,
                                         "Podemos Mover a Chiapas" = color_pmchis,
                                         "Partido Encuentro Solidario Chiapas" = color_pencsolchis,
                                         "Redes Sociales Progresistas Chiapas" = color_rspchis,
                                         "Candidato independiente" = color_otro,
                                         "Ninguno (No leer)" = color_ninguno,
                                         "Ns/Nc (No leer)" = color_nsnc,
                                         "Otro" = color_otro
                     ))

```

# Candidato saldo

```{r}
gr$candidato_saldo(patron_inicial = "opinion", aspectos = c("era", "sasil"), positivos = c("Buena"), negativos = c("Mala"),
                   color_positivo = "orange", color_negativo = "brown")

```
