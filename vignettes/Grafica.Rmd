---
title: "Clase Grafica"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Clase Grafica}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.asp = .6, fig.width = 12, out.width="100%", dpi = 300
)
```

```{r setup}
library(encuestar)
library(dplyr)
# usethis::load_all()
```

```{r correcciones_data}
datos_demo <- datos_demo |> mutate(across(contains("evaluacion_"), ~as.numeric(.x)))
cuestionario_demo <-  cuestionario_demo|> 
  mutate(tema = if_else(llaves =="evaluacion_amlo", "AMLO", tema),
         tema = if_else(llaves =="evaluacion_rutilio", "Rutilio", tema)
  )
```


```{r clase_grafica}
diseno <- survey::svydesign(ids = ~1, data = datos_demo)

gr <- Grafica$new(diseno = diseno, diccionario = cuestionario_demo, tema = tema_default)

```

# Gauge numérica

```{r}
gr$gauge_numerica(codigo = evaluacion_amlo, color = "red", escala = c(0, 11), size_text_pct = 18)

```

# Gauge categórica

```{r}
gr$gauge_categorica(codigo = persona_lenguaindigena, filtro = "respuesta == 'Sí'", color = "red", escala = c(0, 1), size_text_pct = 18)

```

# Barras categórica

```{r}
gr$barras_categorica(codigo = problema_masimportante, 
                     salto = 20)

```

# Barras numérica

```{r}
gr$barras_numerica(patron_inicial = conocimiento,
                   aspectos = c("era", "sasil"), filtro = "respuesta == 'Sí'",
                   salto = 20, porcentajes_fuera = F)

```

# Barras multirespuesta

```{r}
gr$barras_multirespuesta()

```

# Intervalo numérica

```{r}
gr$intervalo_numerica(patron = "evaluacion", aspectos = c("amlo", "rutilio"), escala = c(0, 10))

```

# Sankey

```{r}
gr$sankey_categorica(variables = c("sexo", "conocimiento_manuelita"))

```

# Nube de texto
```{r}
gr$nube_texto(codigo = "problema_masimportante_otro",
              palabrasVacias = c("muy", "anteriores", "mas", "todas", "falta"),
              total_palabras = 15)

```

# Candidato opinion

```{r}
gr$candidato_opinion(patron_inicial = opinion,
                     aspectos = c("era", "sasil"), ns_nc = "Ns/Nc (No leer)", regular = "Regular (No leer)",
                     grupo_positivo= c("Buena"), grupo_negativo = c("Mala"),
                     orden_resp = c("Mala", "Regular (No leer)", "Buena"))

```

# Candidato partido

```{r}
nombres_candidatos <- cuestionario_demo %>%
  filter(grepl(pattern = "Bloque 5:", x = bloque)) |>
  filter(grepl("partido_",llaves)) %>%
  pull(tema)

color_morena <- "#A6032F"
color_morena_complemento <- "#F5CD5F"
color_panal <- "#03A6A6"
color_pt <- "#D91136"
color_pri <- "#038C33"
color_mc <- "#F27405"
color_pvem <- "#98BF5E"
color_pan <- "#0339a6"
color_prd <- "#F2B705"

color_pencsolchis <- "#AE95BF"
color_chisunido <- "#0396A6"
color_rspchis <-"#D9526B"
color_pmchis <- "#6B3A8C"

color_otro <- "gray30"
color_ninguno <- "black"
color_nsnc <- "gray60"

gr <- Grafica$new(diseno = diseno, diccionario = cuestionario_demo, tema = tema_default)

gr$candidato_partido(llave_partido = "partido", llave_conocimiento = "conocimiento", respuesta_conoce = "Sí",
                     candidatos = c("era", "sasil"), corte_otro = 0.03, cliente = c("era", "sasil"),
                     colores_candidatos = rep("#5B0A1C", 6) %>% purrr::set_names(nombres_candidatos),
                     colores_partido = c("PAN" = color_pan,
                                         "PRI" = color_pri,
                                         "PRD" = color_prd,
                                         "PT" = color_pt,
                                         "Partido Verde (PVEM)" = color_pvem,
                                         "Movimiento Ciudadano (MC)" = color_mc,
                                         "MORENA" = color_morena,
                                         "Chiapas Unido" = color_chisunido,
                                         "Podemos Mover a Chiapas" = color_pmchis,
                                         "Partido Encuentro Solidario Chiapas" = color_pencsolchis,
                                         "Redes Sociales Progresistas Chiapas" = color_rspchis,
                                         "Candidato independiente" = color_otro,
                                         "Ninguno (No leer)" = color_ninguno,
                                         "Ns/Nc (No leer)" = color_nsnc,
                                         "Otro" = color_otro
                     ))

```

# Candidato saldo

```{r}
gr$candidato_saldo(patron_inicial = "opinion", aspectos = c("era", "sasil"), positivos = c("Buena"), negativos = c("Mala"),
                   color_positivo = "orange", color_negativo = "brown")

```

# Métododología de MORENA

```{r}
candidatos <- cuestionario_demo %>%
  filter(grepl("Bloque 5", bloque)) |>
  filter(grepl("opinion_",llaves)) |>
  pull(llaves) %>%
  gsub(pattern = "opinion_", replacement = "", x = .)

atributos <- tibble(atributo = c("honesto", "mujeres", "cercano", "estado", "cumple"),
                    puntos = c(1,.5,.25,.25,.25))

gr <- Grafica$new(diseno = diseno, diccionario = cuestionario_demo, tema = tema_default)

gr$metodo_morena(personajes = candidatos, atributos = atributos)

```

# Cruce por puntos
```{r}

variablesConocimiento <- cuestionario_demo %>%
  filter(grepl(pattern = "Bloque 3", x = bloque)) |>
  filter(grepl(pattern = "conocimiento_", x = llaves)) |>
  pull(llaves)

gr$puntos(cruce = "sexo",
          variables = variablesConocimiento,
          vartype = "cv", valor_variables = "Sí")

```

# Cruce brechas duales
```{r}

gr$brechasDuales(var1 = "AMAI_factor",
                 var2_filtro = "candidato_preferencia",
                 filtro = c("Carlos Morales", "Sasil de León", "Eduardo Ramírez Aguilar"),
                 vartype = "cv",
                 line_rich = F,
                 line_linewidth = 2, line_hjust = 0.5, line_vjust = -0.5)

```

# Cruce brechas multiples
```{r}

gr$brechasMultiples(por_grupo = "AMAI_factor",
                    variables=c("conocimiento_manuelita",
                                "conocimiento_carlos",
                                "conocimiento_era",
                                "conocimiento_sasil"),
                    valor_variables = "Sí", vartype = "cv", line_rich = F,
                    line_linewidth = 2, line_hjust = "ymax", line_vjust = -0.5)

```

# Cruce barras multiples
```{r}

gr$barrasMultiples(por_grupo = "AMAI_factor", variables = c("conocimiento_manuelita",
                                                   "conocimiento_carlos",
                                                   "conocimiento_era",
                                                   "conocimiento_sasil"), valor_variables = "Sí", vartype = "cv", color = "red")

```

# Cruce bloques
```{r}

gr$bloques(cruce = "seg_voto", filter = c("Ns/Nc", NA),
           variable = "voto_candidato",
           vartype = "cv")

```

# Correspondencia
```{r}

gr$correspondencia(var1 = "sexo", var2 = "preferencia_candidatopresidencia", legenda1 = "a", legenda2 = "b", colores = c("red", "blue"))

```

# Componentes principales
```{r}

gr$componentesPrincipales(variables = c("sexo", "conocimiento_era"))

```

# Black box
```{r}

gr$blackBox(vars = "sexo", stimuli = "edad")

```
